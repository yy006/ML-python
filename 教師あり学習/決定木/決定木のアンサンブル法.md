# 決定木のアンサンブル法

複数の機械学習モデルを組み合わせることで、より強力なモデルを構築する手法。  
さまざまなデータセットに対するクラス分類や回帰に関して有効であることがわかっているアンサンブル法が
2つある。

# ランダムフォレスト

-----
## 概要

------
決定木の最大の問題点、過剰適合に対応するための方法の一つ。  
少しづつ異なる決定木をたくさん集めたものであり、それぞれ異なった方向に過剰適合した決定木をたくさん作れば、その結果の平均をとることで過剰適合の度合いを減らすことができる。

それぞれの決定木は、ある程度ターゲット値を予測できていて、さらにお互いに違っていなければならない。  
ランダムフォレストに乱数を導入する方法は2つある。
- 決定木を作るためのデータポイントを選択する方法
- 分枝テストに用いる特徴を選択する方法

## ランダムフォレストの構築

-----
(独立した)決定木の数を決める
これの決定木が異なるように、それぞれに対して異なる乱数選択を行う

 データから __ブーストトラップサンプリング__ と呼ばれるものを行う  
- n_sample個のデータポイントからランダムにn_sample回選び出す
- 新しく出来たデータセットを用いて決定木を作る  
決定木は、特徴量のサブセットをランダムに選び、その特徴量を使うものの中から最適なテストを選ぶ　　
特徴量サブセットの大きさは、パラメータmax_featuresで制御できる。　　

max_featuresを大きくすると、ランダムフォレスト中の決定木が似たようなものになり、最も識別性の高い特徴量を使うので、訓練データに容易に適
合できる。  

max_featuresを小さくすると、ランダムフォレスト中の決定木は相互に大幅に異なるものとなるが、それぞれの決定木をかなり深く作らないと、データに適合できない。


## 長所、短所、パラメータ

------
回帰でもクラス分類でも、ランダムフォレストが現在最も広く使われている機械学習手法である。
その中で、決定木を使う理由があるとしたら、決定プロセスの簡潔な表現がほしい場合ぐらい。
したがって、予測の過程を専門家でない人にもわかるように可視化したいのであれば、単独の決定木を使ったほう
がよい  

CPUコア数を増やすと線形に速度が向上する  

乱数のシード（random_state）を変更すると（もしくはrandom_stateを設定しないと）構築されるモデルが大きく変わる可能性があるが、ランダムフォレスト中の決定木の数が増えると、乱数シードの選択の影響を受けにくくなる。  
結果を再現可能にしたいのであればrandom_stateを固定する必要がある。

非常に高次元で疎なデータに対しては、線形モデルの方が適している。実行時間やメモリが重要なアプリケーションでは、線形モデルを使ったほうがよい。  

# 勾配ブースティング回帰木(勾配ブースティングマシン)

----

## 概要

----
このモデルは回帰にもクラス分類にも利用できる。  

ランダムフォレストと対象的に、勾配ブースティングでは、1つ前の決定木の誤りを次
の決定木が修正するようにして、決定木を順番に作っていく。  
この時、乱数性はなく、代わりに強力な事前枝刈りが用いられる。

勾配ブースティング回帰木では、深さ1から5ぐらいの非常に浅い決定木(弱学習機)が用いられる。これによって、モデルの占めるメモリが小さくなり、予測も速くなる。

ランダムフォレストに比べるとパラメータ設定の影響を受けやすいが、パラメータさえ正しく設定されていれば、こちらのほうが性能が良い。  

事前枝刈りと決定木の数以外に、learning_rate(学習率という)パラメータがある。(重要)  
これは、個々の決定木が、それまでの決定木の過ちをどれくらい強く補正しようとするかを制御するパラメータである。
- 学習率を大きくして強く補正しようとすると、モデルは複雑になる
- 決定木の数を増やすと、訓練セットに対する過ちを補正する機会が増えるので、モデルは複雑になる

## 構築

----
詳しく書いていなかったので、何かいい本やサイト募集中です

## 長所、短所、パラメータ

----
短所：パラメータのチューニングに細心の注意が必要である。訓練にかかる時間が長い。

長所：他の決定木ベースのモデルと同じように、特徴量のスケール変換をする必要はない。
2値特徴量と連続値特徴量が混在していてもうまく機能する。高次元の疎なデータに対してはあまりうまく機能しない。  

パラメータ：
- 決定木の数
- 学習率  
個々の決定木がそれまでの決定木の誤りを補正する度合いを制御
- 決定木の深さ  
個々の決定木の複雑さを減らす　　

一般に勾配ブースティングでは、max_depthは非常に小さく設定される。深さが5
以上になることはあまりない。